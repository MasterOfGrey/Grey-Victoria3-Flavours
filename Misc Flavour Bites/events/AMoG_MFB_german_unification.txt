namespace = german_unification

# North/South German Confederation
german_unification.1 = {
	type = country_event
	placement = ROOT

	title = german_unification.1.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = german_unification.1.d1
				trigger = {
					country_has_primary_culture = cu:north_german
				}
			}
			triggered_desc = {
				desc = german_unification.1.d2
				trigger = {
					country_has_primary_culture = cu:south_german
				}
			}
		}
	}
	flavor = german_unification.1.f

	event_image = {
		video = "unspecific_signed_contract"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/waving_flag.dds"

	duration = 3

	trigger = {
	}

	immediate = {
		set_variable = je_german_confederate_unifier

		every_country = {
			limit = {
				country_rank < rank_value:great_power
				OR = {
					AND = {
						root = { country_has_primary_culture = cu:north_german }
						country_has_primary_culture = cu:north_german
					}
					AND = {
						root = { country_has_primary_culture = cu:south_german }
						country_has_primary_culture = cu:south_german
					}
				}
				NOR = {
					THIS = ROOT
					is_subject_type = subject_type_colony
					is_subject_type = subject_type_dominion
					is_subject_type = subject_type_chartered_company
				}
			}

			if = {
				limit = {
					is_ai = yes
					OR = {
						is_in_customs_union_with = root
						is_supporting_unification_candidate = { who = root country_formation = GER }
					}
				}
				root = { annex_with_incorporation = prev }
			}
			else = {
				trigger_event = { id = german_unification.2 days = 0 popup = yes }
			}
		}
	}

	option = {
		name = german_unification.1.a
		default_option = yes
		every_interest_group = {
			limit = {
				is_in_government = yes
			}
			leader = {
				add_modifier = {
					name = german_unification_popularity
					days = long_modifier_time
				}
			}
		}
		if = {
			limit = {
				country_has_primary_culture = cu:north_german
				NOT = { exists = c:NGF }
				OR = {
					country_tier = kingdom
					country_tier = principality
				}
			}

			# Reconcile with Austria if we didn't conquer states from them or release any crucial territories
			hidden_effect = {
				if = {
					limit = {
						exists = c:AUS
						c:AUS = {
							country_rank >= rank_value:great_power
							NOT = { has_claim = root }
							owns_entire_state_region = STATE_BOHEMIA
							owns_entire_state_region = STATE_CENTRAL_HUNGARY
							owns_entire_state_region = STATE_LOMBARDY
						}
					}

					c:AUS = {
						set_mutual_secret_goal = {
							country = root
							secret_goal = reconcile
						}
					}
				}
			}
			change_tag = NGF
		}
		else_if = {
			limit = {
				country_has_primary_culture = cu:south_german
				NOT = { exists = c:SGF }
				OR = {
					country_tier = kingdom
					country_tier = principality
				}
			}
			change_tag = SGF
			every_state = {
				limit = {
					state_region = {
						is_homeland = cu:south_german
					}
					NOT = { has_claim_by = ROOT }
					NOT = { owner = ROOT }
					NOT = { region = sr:region_danubia }
				}
				state_region = {
					add_claim = c:SGF # ROOT # 
				}
			}
		}
	}
	option = {
		name = german_unification.1.b
		add_modifier = {
			name = partial_german_unification_influence_prestige
			days = normal_modifier_time
		}
		if = {
			limit = {
				country_has_primary_culture = cu:north_german
				NOT = { exists = c:NGF }
				OR = {
					country_tier = kingdom
					country_tier = principality
				}
			}
			change_tag = NGF
		}
		else_if = {
			limit = {
				country_has_primary_culture = cu:south_german
				NOT = { exists = c:SGF }
				OR = {
					NOT = { exists = c:AUS }
					NOT = { THIS = c:AUS }
				}
				OR = {
					country_tier = kingdom
					country_tier = principality
				}
			}
			change_tag = SGF
			every_state = {
				limit = {
					state_region = {
						is_homeland = cu:south_german
					}
					NOT = { has_claim_by = ROOT }
					NOT = { owner = ROOT }
					NOT = { region = sr:region_danubia }
				}
				state_region = {
					add_claim = c:SGF # ROOT # 
				}
			}
		}
	}
}

# Annex a German country after forming NGF/SGF
german_unification.2 = {
	type = country_event
	placement = ROOT

	title = german_unification.2.t
	desc = german_unification.2.d
	flavor = german_unification.2.f

	event_image = {
		video = "unspecific_signed_contract"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/waving_flag.dds"

	duration = 3

	immediate = {
		random_country = {
			limit = { 
				is_unification_candidate = GER
				OR = {
					AND = {
						root = { country_has_primary_culture = cu:north_german }
						country_has_primary_culture = cu:north_german
					}
					AND = {
						root = { country_has_primary_culture = cu:south_german }
						country_has_primary_culture = cu:south_german
					}
				}
			}
			save_scope_as = german_unification_candidate
		}
	}

	option = {
		name = german_unification.2.a
		trigger = {
			OR = {
				is_subject = no
				is_subject_of = scope:german_unification_candidate
			}
		}
		scope:german_unification_candidate = { annex_with_incorporation = root }
		ai_chance = {
			base = 9
		}
	}
	option = {
		name = german_unification.2.b
		default_option = yes
		add_radicals = {
			value = medium_radicals
			culture = cu:south_german
		}
		add_radicals = {
			value = medium_radicals
			culture = cu:north_german
		}
		change_relations = {
			country = scope:german_unification_candidate
			value = -50
		}
		every_scope_state = {
			if = {
				limit = {
					NOT = { has_claim_by = scope:german_unification_candidate }
				}
			}
			state_region = {
				add_claim = scope:german_unification_candidate
			}
		}
		hidden_effect = {
			scope:german_unification_candidate = {
				set_secret_goal = {
					country = root
					secret_goal = conquer
				}
			}
		}

		ai_chance = {
			base = 1
		}
	}
}